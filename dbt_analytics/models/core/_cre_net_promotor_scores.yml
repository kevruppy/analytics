version: 2

models:
  - name: cre_net_promotor_scores
    description: Contains clean net promotor scores (NPS) data
    config:
      enabled: True
      schema: core
      materialized: incremental
    data_tests:
      - dbt_utils.equal_rowcount:
          compare_model: ref("stg_net_promotor_scores")
      - value_proportion:
          expression: "IS_VALID_RATING=TRUE"
          threshold: 0.99
          config:
            severity: warn
    columns:
      - name: ORDER_ID
        description: Identifier of order that triggered the survey
        data_type: INTEGER
      - name: PRODUCT_NAME
        description: Name of ordered product that triggered the survey
        data_type: VARCHAR
      - name: RATING_DATE
        description: Date on which rating was collected
        data_type: DATE
      - name: RATING_VALUE
        description: NPS rating given by customer
        data_type: INTEGER
      - name: RATING_TOOL
        description: Tool with which the rating was collected
        data_type: VARCHAR
        data_tests:
          - accepted_values:
              values: ["SURVEYMONKEY", "QUALTRICS"]
      - name: IS_VALID_RATING
        description: Flag if rating is between 0 and 10 (= valid)
        data_type: BOOLEAN
        data_tests:
          - not_null