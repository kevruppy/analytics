# analytics

## Description

This repository uses **DuckDB** and **MotherDuck** along with **dbt** to simulate a modern data stack.

## VS Code Setup

### Initialization

To work on this project Git, VS Code and Docker Desktop are required.
The following extensions need to be added to VS Code:

- Docker
- Dev Containers

The repository can then be cloned and opened in VS Code.
VS Code will then automatically take care of the setup:
VS Code will use `.devcontainer/Dockerfile` and build an image with latest Python.
Thereby extensions listed in `.devcontainer/devcontainer.json` will be installed.
Finally a _postCreateCommand_ is executed which will do the following things:

1. Create a virtual environment
2. Install dependencies using `requirements.txt`
3. Activate virtual environment
4. Install dbt dependencies using `dbt deps`
5. Install `pre-commit`

### Configurations

All necessary configurations are handled via config files.
We will go through them step by step.

`.devcontainer/devcontainer.json`
Defines Dockerfile to be used, VS Code extensions to be installed & **postCreateCommand**
**postCreateCommand** is executed once container is ready
It will create a virtual environment and install Python & dbt dependencies as well as pre-commit-hooks

`.devcontainer/Dockerfile`
Used to build the image for the container in which we execute code locally
Nothing fancy (just Python) but note that locales need attention

`.vscode/settings.json`
This file has multiple purposes: 1. Define default formatters for languages 2. Configure behavior of extensions 3. Configure checks for dbt related yml files 4. Configure generic VS Code editor settings

`.dbt-checkpoint.yaml`

Basic configs for dbt-checkpoint (dbt package)

`.env`
Stores environment variables or paths pointing to them (in case of secrets).
NOTE: Obviously secrets are listed in `.gitignore`
The purpose of each environment variable is mentioned in the file itself (comments).

`.flake8`
Contains config for `flake8` a tool for Python style guide enforcement.
Besides adjusting the value for `max-line-length` we keep defaults.

`.gitattributes`
Ensures consistent line endings across different operating systems.
This config is necessary as we are running Dev Containers (Linux) on Windows.

`.gitignore`
Ignored are .venv, caches, some dbt related assets, secrets and temporary log files.

`-pre-commit-config.yaml`
In this file we are defining pre-commit hooks.
For details see: <TBD>

`.sqlfluff`
This file is used to define rules used by `sqlfluff` (SQL Linter)
For details see: <TBD>

`.sqlfluffignore`
Lists paths to be ignored by `sqlfluff`.
We do not want to lint SQL generated by dbt or SQL not written by ourselves (dbt-packages).
In addition we are ignoring dbt macros, because the heavy usage of Jinja causes headaches when trying to lint them.

`requirements_cicd.txt`
Requirements to be installed when running Github Actions

`requirements.txt`
See VS Code Setup/Initialization
