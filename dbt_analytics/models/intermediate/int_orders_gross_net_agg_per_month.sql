WITH CTE AS (
	SELECT
		'GROSS_ORDER' AS ORDER_TYPE
		,DATE_TRUNC('MONTH',CREATION_DATE) AS CREATION_MONTH
		,PRODUCT_NAME
		,COUNT(*) AS CNT_ORDERS
	FROM
		{{ ref('int_orders_status_dates') }}
	GROUP BY ALL
	UNION ALL
	SELECT
		'NET_ORDER' AS ORDER_TYPE
		,DATE_TRUNC('MONTH',CREATION_DATE) AS CREATION_MONTH
		,PRODUCT_NAME
		,COUNT(*) AS CNT_ORDERS
	FROM
		{{ ref('int_orders_status_dates') }}
	WHERE
		TRUE
		AND
		IS_CONFIRMED = TRUE
	GROUP BY ALL
)

SELECT
	ORDER_TYPE
	,CREATION_MONTH
	,PRODUCT_NAME
	,CNT_ORDERS::INTEGER AS CNT_ORDERS
FROM
	CTE
