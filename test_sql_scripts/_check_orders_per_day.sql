WITH CTE_CAL AS (
	SELECT CALENDAR_DATE
	FROM
		STAGE.STG_CALENDAR --noqa
	WHERE
		CALENDAR_DATE BETWEEN '2022-01-01' AND '2023-12-31'
)

,CTE_PRODUCTS AS (
	SELECT DISTINCT PRODUCT_NAME
	FROM
		MARTS.MRT_ORDERS
)

,CTE_DIMS AS (
	SELECT COLUMNS(*) --noqa
	FROM
		CTE_CAL
	CROSS JOIN
		CTE_PRODUCTS
)

,CTE_ORD AS (
	SELECT
		CREATION_DATE
		,PRODUCT_NAME
		,COUNT(*) AS CNT
	FROM
		MARTS.MRT_ORDERS
	GROUP BY
		ALL
)

SELECT
	CTE_DIMS.*
	,CTE_ORD.CNT
FROM
	CTE_DIMS
LEFT OUTER JOIN
	CTE_ORD
	ON
		CTE_DIMS.CALENDAR_DATE = CTE_ORD.CREATION_DATE
		AND
		CTE_DIMS.PRODUCT_NAME = CTE_ORD.PRODUCT_NAME
